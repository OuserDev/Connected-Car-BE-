<!DOCTYPE html>
<html>
    <head>
        <title>ì»¤ë„¥í‹°ë“œì¹´ BE API í…ŒìŠ¤íŠ¸ - Connected Car Service</title>
        <meta charset="utf-8" />
        <style>
            body {
                font-family: Arial, sans-serif;
                margin: 20px;
                background: #f5f5f5;
            }
            .container {
                max-width: 1400px;
                margin: 0 auto;
                background: white;
                padding: 20px;
                border-radius: 8px;
            }
            .header {
                text-align: center;
                color: #333;
                margin-bottom: 20px;
            }
            .section {
                margin-bottom: 20px;
                padding: 15px;
                border: 1px solid #ddd;
                border-radius: 5px;
            }
            .section h3 {
                color: #2c5aa0;
                margin-top: 0;
            }
            .form-group {
                margin-bottom: 10px;
                display: inline-block;
                margin-right: 15px;
            }
            .form-group label {
                display: block;
                margin-bottom: 5px;
                font-weight: bold;
                font-size: 12px;
            }
            .form-group input,
            .form-group select,
            .form-group textarea {
                padding: 6px;
                border: 1px solid #ddd;
                border-radius: 4px;
                font-size: 12px;
            }
            .btn {
                padding: 6px 12px;
                border: none;
                border-radius: 4px;
                cursor: pointer;
                margin: 2px;
                font-size: 11px;
            }
            .btn-primary {
                background: #2c5aa0;
                color: white;
            }
            .btn-success {
                background: #28a745;
                color: white;
            }
            .btn-warning {
                background: #ffc107;
                color: #212529;
            }
            .btn-danger {
                background: #dc3545;
                color: white;
            }
            .btn-info {
                background: #17a2b8;
                color: white;
            }
            .btn-secondary {
                background: #6c757d;
                color: white;
            }
            .btn:hover {
                opacity: 0.8;
            }
            .card-grid {
                display: grid;
                grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
                gap: 10px;
                margin-top: 10px;
            }
            .card {
                background: #f8f9fa;
                border: 1px solid #dee2e6;
                border-radius: 6px;
                padding: 10px;
            }
            .card h4 {
                margin: 0 0 8px 0;
                color: #2c5aa0;
                font-size: 14px;
            }
            .card-info {
                font-size: 11px;
                margin-bottom: 3px;
            }
            .auth-status {
                padding: 8px;
                border-radius: 4px;
                margin-bottom: 15px;
                text-align: center;
                font-weight: bold;
            }
            .auth-success {
                background: #d4edda;
                color: #155724;
            }
            .auth-failed {
                background: #f8d7da;
                color: #721c24;
            }
            #result {
                background: #f8f9fa;
                border: 1px solid #dee2e6;
                border-radius: 4px;
                padding: 15px;
                margin-top: 20px;
                white-space: pre-wrap;
                font-family: monospace;
                max-height: 500px;
                overflow-y: auto;
                font-size: 11px;
            }
            .api-section {
                border-left: 4px solid #2c5aa0;
                padding-left: 15px;
            }
            .control-row {
                display: flex;
                flex-wrap: wrap;
                gap: 8px;
                align-items: end;
                margin-bottom: 10px;
            }
        </style>
    </head>
    <body>
        <div class="container">
            <div class="header">
                <h1>ğŸš— Connected Car BE API Test</h1>
                <p>MySQL ê¸°ë°˜ ë°±ì—”ë“œ API í†µí•© í…ŒìŠ¤íŠ¸ ì¸í„°í˜ì´ìŠ¤</p>
                <div id="authStatus" class="auth-status auth-failed">ë¡œê·¸ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤</div>
            </div>

            <!-- 1. ì¸ì¦ ì„¹ì…˜ -->
            <div class="section api-section">
                <h3>ğŸ” 1. Authentication APIs</h3>
                <div class="control-row">
                    <div class="form-group">
                        <label>Username</label>
                        <input id="loginUser" placeholder="username" value="user1" />
                    </div>
                    <div class="form-group">
                        <label>Password</label>
                        <input id="loginPass" type="password" placeholder="password" value="user123" />
                    </div>
                    <button class="btn btn-primary" onclick="login()">ë¡œê·¸ì¸</button>
                    <button class="btn btn-warning" onclick="checkAuthStatus()">ì¸ì¦ìƒíƒœí™•ì¸</button>
                    <button class="btn btn-danger" onclick="logout()">ë¡œê·¸ì•„ì›ƒ</button>
                </div>
            </div>

            <!-- 2. ì‚¬ìš©ì ê´€ë¦¬ ì„¹ì…˜ -->
            <div class="section api-section">
                <h3>ğŸ‘¤ 2. User Management APIs</h3>
                <div class="control-row">
                    <button class="btn btn-info" onclick="getUserProfile()">í”„ë¡œí•„ì¡°íšŒ</button>
                    <button class="btn btn-info" onclick="getUserCards()">ì¹´ë“œëª©ë¡</button>
                    <button class="btn btn-success" onclick="showUserUpdateForm()">í”„ë¡œí•„ìˆ˜ì •</button>
                    <button class="btn btn-success" onclick="showAddCardForm()">ì¹´ë“œì¶”ê°€</button>
                </div>

                <!-- í”„ë¡œí•„ ìˆ˜ì • í¼ -->
                <div id="userUpdateForm" style="display: none; margin-top: 10px">
                    <div class="control-row">
                        <div class="form-group">
                            <label>ì´ë¦„</label>
                            <input id="updateName" placeholder="ì´ë¦„" />
                        </div>
                        <div class="form-group">
                            <label>ì „í™”ë²ˆí˜¸</label>
                            <input id="updatePhone" placeholder="010-1234-5678" />
                        </div>
                        <button class="btn btn-success" onclick="updateUserProfile()">ìˆ˜ì •ì‹¤í–‰</button>
                        <button class="btn btn-secondary" onclick="hideUserUpdateForm()">ì·¨ì†Œ</button>
                    </div>
                </div>

                <!-- ì¹´ë“œ ì¶”ê°€ í¼ -->
                <div id="addCardForm" style="display: none; margin-top: 10px">
                    <div class="control-row">
                        <div class="form-group">
                            <label>ì¹´ë“œë²ˆí˜¸</label>
                            <input id="cardNumber" placeholder="**** **** **** 1234" />
                        </div>
                        <div class="form-group">
                            <label>ì¹´ë“œëª…</label>
                            <input id="cardName" placeholder="í˜„ëŒ€ì¹´ë“œ" />
                        </div>
                        <div class="form-group">
                            <label>ë§Œë£Œì¼</label>
                            <input id="cardExpiry" placeholder="12/25" />
                        </div>
                        <div class="form-group">
                            <label>ê¸°ë³¸ì¹´ë“œ</label>
                            <select id="cardDefault">
                                <option value="false">ì•„ë‹ˆì˜¤</option>
                                <option value="true">ì˜ˆ</option>
                            </select>
                        </div>
                        <button class="btn btn-success" onclick="addUserCard()">ì¹´ë“œì¶”ê°€</button>
                        <button class="btn btn-secondary" onclick="hideAddCardForm()">ì·¨ì†Œ</button>
                    </div>
                </div>
            </div>

            <!-- 3. ì°¨ëŸ‰ ê´€ë¦¬ ì„¹ì…˜ -->
            <div class="section api-section">
                <h3>ğŸš™ 3. Vehicle Management APIs</h3>
                <div class="control-row">
                    <button class="btn btn-info" onclick="getMyCars()">ë‚´ì°¨ëŸ‰ëª©ë¡</button>
                    <button class="btn btn-success" onclick="showRegisterCarForm()">ì°¨ëŸ‰ë“±ë¡</button>
                    <div class="form-group">
                        <label>ì°¨ëŸ‰ID</label>
                        <input id="carId" placeholder="1" value="1" />
                    </div>
                    <button class="btn btn-info" onclick="getCarInfo()">ì°¨ëŸ‰ìƒì„¸ì •ë³´</button>
                    <button class="btn btn-info" onclick="getCarHistory()">ì œì–´ì´ë ¥</button>
                    <button class="btn btn-info" onclick="getCarSpecs()">ì°¨ëŸ‰ìŠ¤í™</button>
                </div>

                <!-- ì°¨ëŸ‰ ë“±ë¡ í¼ -->
                <div id="registerCarForm" style="display: none; margin-top: 10px">
                    <div class="control-row">
                        <div class="form-group">
                            <label>ëª¨ë¸ID</label>
                            <select id="regModelId">
                                <option value="1">Avante</option>
                                <option value="2">Sonata</option>
                                <option value="3">Genesis G90</option>
                                <option value="4">Tucson</option>
                                <option value="5">Santa Fe</option>
                                <option value="6">IONIQ 5</option>
                                <option value="7">Nexo</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>ì°¨ëŸ‰ë²ˆí˜¸</label>
                            <input id="regLicensePlate" placeholder="12ê°€3456" />
                        </div>
                        <div class="form-group">
                            <label>VIN</label>
                            <input id="regVin" placeholder="KMHL14JA1PA123456" />
                        </div>
                        <button class="btn btn-success" onclick="registerCar()">ë“±ë¡ì‹¤í–‰</button>
                        <button class="btn btn-secondary" onclick="hideRegisterCarForm()">ì·¨ì†Œ</button>
                    </div>
                </div>

                <!-- ë‚´ ì°¨ëŸ‰ ëª©ë¡ í‘œì‹œ -->
                <div id="carsList" class="card-grid"></div>
            </div>

            <!-- 4. ì°¨ëŸ‰ ìŠ¤í™ ì„¹ì…˜ -->
            <div class="section api-section">
                <h3>ğŸ“Š 4. Vehicle Specs APIs</h3>
                <div class="control-row">
                    <button class="btn btn-info" onclick="getAllSpecs()">ì „ì²´ìŠ¤í™</button>
                    <div class="form-group">
                        <label>ëª¨ë¸ID</label>
                        <input id="specModelId" placeholder="1" value="1" />
                    </div>
                    <button class="btn btn-info" onclick="getSpecsByModel()">ëª¨ë¸ë³„ìŠ¤í™</button>
                    <div class="form-group">
                        <label>ì¹´í…Œê³ ë¦¬</label>
                        <select id="specCategory">
                            <option value="ìŠ¹ìš©ì°¨">ìŠ¹ìš©ì°¨</option>
                            <option value="SUV">SUV</option>
                        </select>
                    </div>
                    <button class="btn btn-info" onclick="getSpecsByCategory()">ì¹´í…Œê³ ë¦¬ë³„ìŠ¤í™</button>
                </div>
            </div>

            <!-- 5. ì£¼í–‰ ê¸°ë¡ ì„¹ì…˜ -->
            <div class="section api-section">
                <h3>ğŸ“ˆ 5. Driving Records APIs</h3>
                <div class="control-row">
                    <button class="btn btn-info" onclick="getDrivingRecords()">ì£¼í–‰ê¸°ë¡ì¡°íšŒ</button>
                    <button class="btn btn-success" onclick="showAddDrivingForm()">ì£¼í–‰ê¸°ë¡ì¶”ê°€</button>
                </div>

                <!-- ì£¼í–‰ ê¸°ë¡ ì¶”ê°€ í¼ -->
                <div id="addDrivingForm" style="display: none; margin-top: 10px">
                    <div class="control-row">
                        <div class="form-group">
                            <label>ì°¨ëŸ‰ID</label>
                            <input id="drivingCarId" placeholder="1" value="1" />
                        </div>
                        <div class="form-group">
                            <label>ê±°ë¦¬(km)</label>
                            <input id="drivingDistance" placeholder="15.5" />
                        </div>
                        <div class="form-group">
                            <label>ì‹œê°„(ë¶„)</label>
                            <input id="drivingDuration" placeholder="30" />
                        </div>
                        <div class="form-group">
                            <label>ì—°ë¹„(km/L)</label>
                            <input id="drivingEfficiency" placeholder="12.5" />
                        </div>
                        <button class="btn btn-success" onclick="addDrivingRecord()">ê¸°ë¡ì¶”ê°€</button>
                        <button class="btn btn-secondary" onclick="hideAddDrivingForm()">ì·¨ì†Œ</button>
                    </div>
                </div>
            </div>

            <!-- 6. ì‹œìŠ¤í…œ ì„¹ì…˜ -->
            <div class="section api-section">
                <h3>ğŸ”§ 6. System APIs</h3>
                <div class="control-row">
                    <button class="btn btn-info" onclick="checkHealth()">ì‹œìŠ¤í…œìƒíƒœí™•ì¸</button>
                    <button class="btn btn-warning" onclick="clearResult()">ê²°ê³¼ì°½ì§€ìš°ê¸°</button>
                </div>
            </div>

            <!-- ê²°ê³¼ í‘œì‹œ ì˜ì—­ -->
            <div id="result">API ê²°ê³¼ê°€ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤...</div>
        </div>

        <script>
            const API = `http://${window.location.hostname}:4080`;
            let currentUser = null;

            function log(data) {
                document.getElementById('result').textContent = JSON.stringify(data, null, 2);
            }

            function updateAuthStatus(user = null) {
                const statusEl = document.getElementById('authStatus');
                if (user) {
                    statusEl.textContent = `ë¡œê·¸ì¸ë¨: ${user.username} (${user.name})`;
                    statusEl.className = 'auth-status auth-success';
                    currentUser = user;
                } else {
                    statusEl.textContent = 'ë¡œê·¸ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤';
                    statusEl.className = 'auth-status auth-failed';
                    currentUser = null;
                }
            }

            // === 1. ì¸ì¦ APIs ===
            async function login() {
                try {
                    const username = document.getElementById('loginUser').value;
                    const password = document.getElementById('loginPass').value;

                    const response = await fetch(`${API}/api/auth/login`, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        credentials: 'include',
                        body: JSON.stringify({ username, password }),
                    });

                    const data = await response.json();
                    log(data);

                    if (data.user) {
                        updateAuthStatus(data.user);
                    }
                } catch (error) {
                    log({ error: error.message });
                }
            }

            async function logout() {
                try {
                    const response = await fetch(`${API}/api/auth/logout`, {
                        method: 'POST',
                        credentials: 'include',
                    });

                    const data = await response.json();
                    log(data);
                    updateAuthStatus();
                } catch (error) {
                    log({ error: error.message });
                }
            }

            async function checkAuthStatus() {
                try {
                    const response = await fetch(`${API}/api/auth/status`, {
                        credentials: 'include',
                    });

                    const data = await response.json();
                    log(data);

                    if (data.user) {
                        updateAuthStatus(data.user);
                    } else {
                        updateAuthStatus();
                    }
                } catch (error) {
                    log({ error: error.message });
                    updateAuthStatus();
                }
            }

            // === 2. ì‚¬ìš©ì ê´€ë¦¬ APIs ===
            async function getUserProfile() {
                try {
                    const response = await fetch(`${API}/api/user/profile`, {
                        credentials: 'include',
                    });
                    const data = await response.json();
                    log(data);
                } catch (error) {
                    log({ error: error.message });
                }
            }

            async function getUserCards() {
                try {
                    const response = await fetch(`${API}/api/user/cards`, {
                        credentials: 'include',
                    });
                    const data = await response.json();
                    log(data);
                } catch (error) {
                    log({ error: error.message });
                }
            }

            function showUserUpdateForm() {
                document.getElementById('userUpdateForm').style.display = 'block';
            }

            function hideUserUpdateForm() {
                document.getElementById('userUpdateForm').style.display = 'none';
            }

            async function updateUserProfile() {
                try {
                    const name = document.getElementById('updateName').value;
                    const phone = document.getElementById('updatePhone').value;

                    const updateData = {};
                    if (name) updateData.name = name;
                    if (phone) updateData.phone = phone;

                    const response = await fetch(`${API}/api/user/profile`, {
                        method: 'PUT',
                        headers: { 'Content-Type': 'application/json' },
                        credentials: 'include',
                        body: JSON.stringify(updateData),
                    });

                    const data = await response.json();
                    log(data);
                    hideUserUpdateForm();
                } catch (error) {
                    log({ error: error.message });
                }
            }

            function showAddCardForm() {
                document.getElementById('addCardForm').style.display = 'block';
            }

            function hideAddCardForm() {
                document.getElementById('addCardForm').style.display = 'none';
            }

            async function addUserCard() {
                try {
                    const cardData = {
                        card_number: document.getElementById('cardNumber').value,
                        card_name: document.getElementById('cardName').value,
                        expiry_date: document.getElementById('cardExpiry').value,
                        is_default: document.getElementById('cardDefault').value === 'true',
                    };

                    const response = await fetch(`${API}/api/user/cards`, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        credentials: 'include',
                        body: JSON.stringify(cardData),
                    });

                    const data = await response.json();
                    log(data);
                    hideAddCardForm();
                } catch (error) {
                    log({ error: error.message });
                }
            }

            // === 3. ì°¨ëŸ‰ ê´€ë¦¬ APIs ===
            async function getMyCars() {
                try {
                    const response = await fetch(`${API}/api/cars`, {
                        credentials: 'include',
                    });
                    const data = await response.json();
                    log(data);
                    displayCars(data.cars || []);
                } catch (error) {
                    log({ error: error.message });
                }
            }

            function displayCars(cars) {
                const container = document.getElementById('carsList');
                container.innerHTML = '';

                cars.forEach((car) => {
                    const carDiv = document.createElement('div');
                    carDiv.className = 'card';
                    carDiv.innerHTML = `
                        <h4>${car.model || 'Unknown'} (ID: ${car.id})</h4>
                        <div class="card-info">ë²ˆí˜¸íŒ: ${car.license_plate}</div>
                        <div class="card-info">VIN: ${car.vin}</div>
                        <div class="card-info">ì¹´í…Œê³ ë¦¬: ${car.category || 'Unknown'}</div>
                        <div class="card-info">ë“±ë¡ì¼: ${car.created_at}</div>
                    `;
                    container.appendChild(carDiv);
                });
            }

            function showRegisterCarForm() {
                document.getElementById('registerCarForm').style.display = 'block';
            }

            function hideRegisterCarForm() {
                document.getElementById('registerCarForm').style.display = 'none';
            }

            async function registerCar() {
                try {
                    const carData = {
                        model_id: parseInt(document.getElementById('regModelId').value),
                        license_plate: document.getElementById('regLicensePlate').value,
                        vin: document.getElementById('regVin').value,
                    };

                    const response = await fetch(`${API}/api/cars/register`, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        credentials: 'include',
                        body: JSON.stringify(carData),
                    });

                    const data = await response.json();
                    log(data);
                    hideRegisterCarForm();
                } catch (error) {
                    log({ error: error.message });
                }
            }

            async function getCarInfo() {
                try {
                    const carId = document.getElementById('carId').value;
                    const response = await fetch(`${API}/api/car/${carId}/info`, {
                        credentials: 'include',
                    });
                    const data = await response.json();
                    log(data);
                } catch (error) {
                    log({ error: error.message });
                }
            }

            async function getCarHistory() {
                try {
                    const carId = document.getElementById('carId').value;
                    const response = await fetch(`${API}/api/car/${carId}/history`, {
                        credentials: 'include',
                    });
                    const data = await response.json();
                    log(data);
                } catch (error) {
                    log({ error: error.message });
                }
            }

            async function getCarSpecs() {
                try {
                    const carId = document.getElementById('carId').value;
                    const response = await fetch(`${API}/api/car/${carId}/specs`, {
                        credentials: 'include',
                    });
                    const data = await response.json();
                    log(data);
                } catch (error) {
                    log({ error: error.message });
                }
            }

            // === 4. ì°¨ëŸ‰ ìŠ¤í™ APIs ===
            async function getAllSpecs() {
                try {
                    const response = await fetch(`${API}/api/specs`, {
                        credentials: 'include',
                    });
                    const data = await response.json();
                    log(data);
                } catch (error) {
                    log({ error: error.message });
                }
            }

            async function getSpecsByModel() {
                try {
                    const modelId = document.getElementById('specModelId').value;
                    const response = await fetch(`${API}/api/specs/${modelId}`, {
                        credentials: 'include',
                    });
                    const data = await response.json();
                    log(data);
                } catch (error) {
                    log({ error: error.message });
                }
            }

            async function getSpecsByCategory() {
                try {
                    const category = document.getElementById('specCategory').value;
                    const response = await fetch(`${API}/api/specs/category/${category}`, {
                        credentials: 'include',
                    });
                    const data = await response.json();
                    log(data);
                } catch (error) {
                    log({ error: error.message });
                }
            }

            // === 5. ì£¼í–‰ ê¸°ë¡ APIs ===
            async function getDrivingRecords() {
                try {
                    const response = await fetch(`${API}/api/driving/records`, {
                        credentials: 'include',
                    });
                    const data = await response.json();
                    log(data);
                } catch (error) {
                    log({ error: error.message });
                }
            }

            function showAddDrivingForm() {
                document.getElementById('addDrivingForm').style.display = 'block';
            }

            function hideAddDrivingForm() {
                document.getElementById('addDrivingForm').style.display = 'none';
            }

            async function addDrivingRecord() {
                try {
                    const recordData = {
                        car_id: parseInt(document.getElementById('drivingCarId').value),
                        distance: parseFloat(document.getElementById('drivingDistance').value),
                        duration: parseInt(document.getElementById('drivingDuration').value),
                        fuel_efficiency: parseFloat(document.getElementById('drivingEfficiency').value),
                    };

                    const response = await fetch(`${API}/api/driving/records`, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        credentials: 'include',
                        body: JSON.stringify(recordData),
                    });

                    const data = await response.json();
                    log(data);
                    hideAddDrivingForm();
                } catch (error) {
                    log({ error: error.message });
                }
            }

            // === 6. ì‹œìŠ¤í…œ APIs ===
            async function checkHealth() {
                try {
                    const response = await fetch(`${API}/api/health`);
                    const data = await response.json();
                    log(data);
                } catch (error) {
                    log({ error: error.message });
                }
            }

            function clearResult() {
                document.getElementById('result').textContent = 'API ê²°ê³¼ê°€ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤...';
            }

            // í˜ì´ì§€ ë¡œë“œ ì‹œ ì¸ì¦ ìƒíƒœ í™•ì¸
            window.onload = function () {
                checkAuthStatus();
            };
        </script>
    </body>
</html>
