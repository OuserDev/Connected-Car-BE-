<!DOCTYPE html>
<html>
<head><title>API Test</title></head>
<body>
<h2>Login Test</h2>
<input id="user" placeholder="username">
<input id="pass" type="password" placeholder="password">
<button onclick="login()">Login</button>

<h2>Register Test</h2>
<input id="regUser" placeholder="username">
<input id="regPass" type="password" placeholder="password">
<input id="regEmail" placeholder="email">
<button onclick="register()">Register</button>

<h2>Car Control Test</h2>
<input id="carId" placeholder="car_id" value="1">
<button onclick="engineOn()">Engine On</button>
<button onclick="engineOff()">Engine Off</button>
<button onclick="doorLock()">Lock</button>
<button onclick="doorUnlock()">Unlock</button>

<h2>Status Check</h2>
<button onclick="authStatus()">Auth Status</button>
<button onclick="carStatus()">Car Status</button>

<pre id="result"></pre>

<script>
const API = 'http://localhost:8000';
function log(data) { document.getElementById('result').textContent = JSON.stringify(data, null, 2); }

async function login() {
  const res = await fetch(`${API}/api/auth/login`, {
    method: 'POST',
    headers: {'Content-Type': 'application/json'},
    credentials: 'include',
    body: JSON.stringify({username: document.getElementById('user').value, password: document.getElementById('pass').value})
  });
  log(await res.json());
}

async function register() {
  const res = await fetch(`${API}/api/auth/register`, {
    method: 'POST',
    headers: {'Content-Type': 'application/json'},
    credentials: 'include',
    body: JSON.stringify({
      username: document.getElementById('regUser').value,
      password: document.getElementById('regPass').value,
      email: document.getElementById('regEmail').value
    })
  });
  log(await res.json());
}

async function engineOn() {
  const res = await fetch(`${API}/api/car/${document.getElementById('carId').value}/command?action=engine_on`, {method: 'POST', credentials: 'include'});
  log(await res.json());
}

async function engineOff() {
  const res = await fetch(`${API}/api/car/${document.getElementById('carId').value}/command?action=engine_off`, {method: 'POST', credentials: 'include'});
  log(await res.json());
}

async function doorLock() {
  const res = await fetch(`${API}/api/car/${document.getElementById('carId').value}/command?action=door_lock`, {method: 'POST', credentials: 'include'});
  log(await res.json());
}

async function doorUnlock() {
  const res = await fetch(`${API}/api/car/${document.getElementById('carId').value}/command?action=door_unlock`, {method: 'POST', credentials: 'include'});
  log(await res.json());
}

async function authStatus() {
  const res = await fetch(`${API}/api/auth/status`, {credentials: 'include'});
  log(await res.json());
}

async function carStatus() {
  const res = await fetch(`${API}/api/car/${document.getElementById('carId').value}/status`, {credentials: 'include'});
  log(await res.json());
}
</script>
</body>
</html>